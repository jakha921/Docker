# Docker user on FastAPI

[pdf](https://cloclo56.datacloudmail.ru/public/view/7Yib95YUzqRtDr4AcoRpmbyCzbLr5DKZ2RfUje6Dmdqq7Wd4rDBgFwDDogC2JcVBeQ86zv/no/%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D1%8B_Docker__Docker_%D0%B8_Python.pdf)

+ `Docker` - мини виртуальная машина или же контейнер для зависимости
+ `Docker-host` - это комп, на котором работает докер: персональный комп, сервер или виртуальный машина в облаке) 
+ `Docker-demon` - управляет всем эти (скачивает, сохраняет, удаляет ). Это фоновый процесс (”душа докера”), который работает постоянно и ожидает команды. Все операции по управлению контейнерами отправляются именно в демон. Например: запустить или остановить контейнер, скачать образ. И уже на основе этих команд демон выполняет необходимые действия с контейнерами и образами. Поэтому докер-демон знает все о контейнерах, запущенных на одном хосте: сколько всего контейнеров, какие из них работают, где хранятся образы и так далее.
+ `Docker-client` - При помощи которого пользователь взаимодействуют с демоном, и отправляет команды(с АПИ или терминал) 
+ `Docker-image` (Докер образ) - это набор файлов необходимый для работы приложение. Аналогия из мира установки ПО: образ — это компакт-диск, с которого устанавливается программа
+ `Docker-container` - Это уже развернутое (на основе образа) и запущенное приложение. Продолжая аналогию с установкой ПО, контейнер можно сравнить с уже установленной и работающей программой на ПК (которую установили с диска - образа)
+ `Dockerfile` - Это файл-инструкция для сборки образа
+ `Docker registry` - Это репозиторий (место), в котором хранятся образы. Когда разработчики создают приложения, они размещают свои образы в этих репозиториях, откуда их могут скачать другие люди. Есть публичные репозитории, например, [Docker Hub](https://hub.docker.com/). Можно создать свой закрытый репозиторий, для использования внутри компании или команды. Это своего рода GitHub, только на котором хранится не программный код, докер-образы. На Docker Hub собраны образы множества популярных программ или платформ: базы данных, веб-серверы, компиляторы, операционные системы и так далее.

  
### Docker-image VS Docker-container

+ `image` - это как установочный пакет зависимости
+ `container` - это уже установленный пакет (расширенный или разархивированный)  т.е установленный все зависимости и готов работать


### Dockerfile

+ `Dockerfile` — это инструкция для сборки образа
+ То есть это файл с построчным перечислением необходимых компонентов и последовательности действий, которые надо
совершить. Подробнее с Dockerfile мы познакомимся дальше.


### Docker compose

+ Нужно для того что бы несколько контейнеров можно было запускать как одно приложение на одно компе
+ _Например:_ У нас есть 4 контейнеров(для **Redis, Frontend, Backend, DB**) и это все должно работать как одно приложение 


### Docker swarm VS Kubernetes

+ `Docker swarm` - Запускать один контейнер на нескольких компах (оркестрация)
+ `Kubernetes` - Тоже запускать один контейнера на нескольких компах служит для масштабных приложениях и сетерзных задач 


### Docker commands

```cmd
sudo docker     # show all commands

sudo docker pull --help     # show options & commands

sudo docker pull <img_name>     # pull the image

sudo docker images      # show my images

sudo docker run -d -p 8080:80 <img_name>    # run on port 8080 on my PC http://localhost:8080/

sudo docker ps      # show runnig(active) container
sudo docker ps -a   # show all containers

sudo docker start <CONTAINER ID/ NAMES>      # start container
sudo docker stop <CONTAINER ID/ NAMES>      # stop container

sudo docker rm <CONTAINER ID/ NAMES>        # remove container
sudo docker rmi <REPOSITORY/ IMAGE ID>      # remove img 

sudo docker exec -it <CONTAINER ID/ NAMES>  # to edit container enter inside of this

# create own img
sudo docker commit -m "msg" -a "<author>" <CONTAINER ID/ NAMES>  <Creating img name>

docker login -u <docker-register-username>  # deploy to docker hub enter login

docker push <img name>  # deploy to docker hub
```


### Dockerfile

`Dockerfile` — это текстовый файл, в котором описан рецепт создания образа Docker. Рецепт состоит из инструкций, которые
выполняются последовательно. Они содержат информацию об операционной системе, выбранной платформе,
фреймворках, библиотеках, инструментах, которые нужно установить.

**Структура Dockerfile**

+ `FROM` — задаёт родительский (главный) образ;
+ `LABEL` — добавляет метаданные для образа. Хорошее место для размещения информации об авторе;
+ `ENV` — создаёт переменную окружения;
+ `RUN` — запускает команды, создаёт слой образа. Используется для установки пакетов и библиотек внутри контейнера;
+ `COPY` — копирует файлы и директории в контейнер;
+ `ADD` — делает всё то же, что и инструкция `COPY` . Но ещё может распаковывать локальные `.tar` файлы;
+ `CMD` — указывает команду и аргументы для выполнения внутри контейнера. Параметры могут быть переопределены.
Использоваться может только одна инструкция `CMD` ;
+ `WORKDIR` — устанавливает рабочую директорию для инструкции `CMD` и `ENTRYPOINT` ;
+ `ARG` — определяет переменную для передачи Docker’у во время сборки;
+ `ENTRYPOINT` — предоставляет команды и аргументы для выполняющегося контейнера. Суть его несколько отличается
от `CMD` , о чём мы поговорим ниже;
+ `EXPOSE` — открывает порт;
+ `VOLUME` — создаёт точку подключения директории для добавления и хранения постоянных данных.

```Docker
sudo docker build -t <img_name> <directory>     # create own image

sudo docker images      # checkout img

sudo docker run <local_port>:<container_port> <image_name> 
```
